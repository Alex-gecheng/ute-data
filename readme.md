## 工艺数据接口

get,post 请求       请求间隔1s

post请求

```
curl -X POST http://localhost:5000/api/process_data ^
 -H "Content-Type: application/json" ^
 -d "{\"code\":\"07_4_3mz2010\"}"
 curl -X POST 
```

get

```
/api/process_data/?code={}
```

返回结果

```json
{
  "data": {
    "进给轮倍率": 1.0,
    "X轴修整跳进量": 18.937,
    "X轴新砂轮修整量": 0.005,
    "上下料位置": 2.0,
    "修整速度": 500.0,
    "修整间隔": 4.0,
    "光磨延时": 0.5,
    "光磨速度": 0.01,
    "光磨量": 0.005,
    "加工方式": 101,
    "工件轴转速": 350.0,
    "快速速率": 15.0,
    "快速量": 0.21,
    "快进速度": 350.0,
    "快进量": 3.12,
    "快速倍率": 0.0,
    "振动距离": 1.3,
    "振动速度": 400.0,
    "新砂轮X轴起始加工位": 0.0,
    "新砂轮修整量": 1.3,
    "新砂轮直径": 28.0,
    "沟位补偿": 0.001,
    "砂轮修整宽度": 25.0,
    "砂轮序号": 51,
    "砂轮最小直径": 20.0,
    "砂轮线速度": 30.0,
    "砂轮轴转速": 23885.0,
    "磨架中位": 0.0,
    "磨架到位": 145.45,
    "磨架原位": 0.0,
    "粗回跳量": 0.0,
    "粗磨1速度": 0.07,
    "粗磨1量": 0.05,
    "粗磨2速度": 0.05,
    "粗磨2量": 0.03,
    "粗磨延时": 0.0,
    "精回跳量": 0.0,
    "精磨速度": 0.03,
    "精磨量": 0.01,
    "进给补偿": 0.001
  },
  "elapsed_ms": 48.5,
  "success": true
}

```

## 效率接口数据

get,post 请求    请求间隔1s

接口

```
/api/efficiency_data/?code={}
```

返回结果

```
{
  "data": {
    "ID": 67953,
    "RecordID": 67453,
    "X轴起始加工位": 2.005,
    "Z轴起始修整位": 25.0,
    "上料等待时长": 0.82,
    "下料等待时长": 0.73,
    "主轴前端温度": 0.0,
    "主轴后端温度": 0.0,
    "修整耗时": 0.905,
    "光磨时长": 10.01,
    "工件轴前端温度": 0.0,
    "工件轴后端温度": 0.0,
    "快速趋近时长": 0.86,
    "快进时长": 2.81,
    "有效磨削开始时间": "Wed, 31 Jul 2024 10:22:40 GMT",
    "有效磨削时长": 23.05,
    "砂轮修整序号": 46,
    "砂轮现在直径": 23.99,
    "磨削总量": 3.44,
    "粗磨1时长": 7.93,
    "粗磨2时长": 0.04,
    "精磨时长": 4.93,
    "进给轴原点位置": 2.005,
    "退刀时长": 2.37
  },
  "elapsed_ms": 44.33,
  "success": true
}

```

## 详细页在线巡检数据

get,post 请求  接口

```
/api/detailed_online_inspection
```

```
curl -X POST http://localhost:5000/api/detailed_online_inspection ^
 -H "Content-Type: application/json" ^
 -d "{\"code\":\"01_2_lxng_da30\"}"
 curl -X POST 
```

请求间隔10s      0.1qps   

结果

```
{
  "data": {
    "上截面圆度": 2.0,
    "上截面圆度结果": "合格",
    "上截面尺寸": -14.1,
    "上截面尺寸结果": "返工",

    "下截面圆度": 4.0,
    "下截面圆度结果": "合格",
    "下截面尺寸": -15.9,
    "下截面尺寸结果": "返工",

    "预检不合格数量": 234,
    "内径合格总数量": 88706,
    "内径合格率": 88.0,
    "内径测量总数量": 100562,

    "内径锥度": 4.0,
    "内径锥度结果": "合格",

    "圆度返工总数量": 0,
    "在线值": 0,

    "尺寸报废总数量": 11622,
    "尺寸返工总数量": 7877,

    "标准件测量值": 66.6,
    "测量值": 0,

    "设备状态": 27,
    "锥度返工总数量": 2565
  },
  "elapsed_ms": 46.68,
  "success": true
}
```

## 首页首巡检数据

get,post 请求    MES数据库

```
EXPLAIN
SELECT *
FROM ute_mes_qms_new.t_qms_sj_taskiptitem
ORDER BY id DESC
LIMIT 3;
```

接口   不需要code

```
/api/home_inspection
```

```
curl   http://localhost:5000/api/home_inspection
```

返回结果

```
{
  "data": [
    {
      "type": "巡检",
      "不合格数": 0,
      "合格数": "12",
      "抽检数": "12"
    },
    {
      "type": "巡检",
      "不合格数": 0,
      "合格数": "12",
      "抽检数": "12"
    },
    {
      "type": "巡检",
      "不合格数": 0,
      "合格数": "14",
      "抽检数": "14"
    }
  ],
  "elapsed_ms": 40.96,
  "success": true
}

```





## 性能分析

sql查询   索引取最后一个数据

微秒级别

api查询     主要在传输时间

```
[查询成功] code=07_4_3mz2010，耗时:44.54ms
```

ssh下，并发     瓶颈在ssh

20qps    1s

```
================================================================================
API 压力测试
================================================================================
目标 URL: http://localhost:5000
Code: 07_4_3mz2010
每个接口请求数: 10
总请求数: 20
================================================================================

开始发送 20 个请求...

[1/20] process_data #2: success (0.800s)
[2/20] process_data #3: success (0.815s)
[3/20] process_data #4: success (0.830s)
[4/20] process_data #5: success (0.845s)
[5/20] process_data #1: success (0.861s)
[6/20] process_data #8: success (0.871s)
[7/20] efficiency_data #1: success (0.883s)
[8/20] process_data #10: success (0.898s)
[9/20] efficiency_data #3: success (0.911s)
[10/20] efficiency_data #2: success (0.927s)
[11/20] efficiency_data #5: success (0.939s)
[12/20] efficiency_data #4: success (0.955s)
[13/20] efficiency_data #7: success (0.967s)
[14/20] efficiency_data #6: success (0.982s)
[15/20] efficiency_data #9: success (0.995s)
[16/20] efficiency_data #8: success (1.011s)
[17/20] process_data #6: success (1.040s)
[18/20] process_data #9: success (1.050s)
[19/20] efficiency_data #10: success (1.055s)
[20/20] process_data #7: success (1.081s)

================================================================================
测试结果统计
================================================================================
总请求数: 20
成功: 20
失败: 0
总耗时: 1.088s

process_data 接口结果:
  请求数: 10
  成功: 10
  平均响应时间: 0.909s
  最快: 0.800s
  最慢: 1.081s
  平均查询时间(API内部): 375.99ms
  返回字段数: 40

efficiency_data 接口结果:
  请求数: 10
  成功: 10
  平均响应时间: 0.962s
  最快: 0.883s
  最慢: 1.055s
  平均查询时间(API内部): 579.53ms
  返回字段数: 22

================================================================================

详细请求结果:
--------------------------------------------------------------------------------
 1. efficiency_data # 1: 0.883s | API耗时: 391.22ms | 字段数: 22
 2. efficiency_data # 2: 0.927s | API耗时: 460.62ms | 字段数: 22
 3. efficiency_data # 3: 0.911s | API耗时: 446.62ms | 字段数: 22
 4. efficiency_data # 4: 0.955s | API耗时: 572.75ms | 字段数: 22
 5. efficiency_data # 5: 0.939s | API耗时: 557.92ms | 字段数: 22
 6. efficiency_data # 6: 0.982s | API耗时: 655.91ms | 字段数: 22
 7. efficiency_data # 7: 0.967s | API耗时: 598.28ms | 字段数: 22
 8. efficiency_data # 8: 1.011s | API耗时: 698.45ms | 字段数: 22
 9. efficiency_data # 9: 0.995s | API耗时: 669.85ms | 字段数: 22
10. efficiency_data #10: 1.055s | API耗时: 743.72ms | 字段数: 22
11. process_data    # 1: 0.861s | API耗时: 259.21ms | 字段数: 40
12. process_data    # 2: 0.800s | API耗时: 44.8ms | 字段数: 40
13. process_data    # 3: 0.815s | API耗时: 142.17ms | 字段数: 40
14. process_data    # 4: 0.830s | API耗时: 171.51ms | 字段数: 40
15. process_data    # 5: 0.845s | API耗时: 214.95ms | 字段数: 40
16. process_data    # 6: 1.040s | API耗时: 701.69ms | 字段数: 40
17. process_data    # 7: 1.081s | API耗时: 757.86ms | 字段数: 40
18. process_data    # 8: 0.871s | API耗时: 302.49ms | 字段数: 40
19. process_data    # 9: 1.050s | API耗时: 730.28ms | 字段数: 40
20. process_data    #10: 0.898s | API耗时: 434.9ms | 字段数: 40
```

